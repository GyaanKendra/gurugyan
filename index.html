<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Success Stories</title>
  <style>
    body {font-family: Arial, sans-serif; margin:0; background:#f4f6f9;}
    .success-stories {background:#d4eaff; padding:50px 15px;}
    .success-stories h2 {text-align:center; font-size:2rem; margin-bottom:25px; color:#222;}
    .success-box {display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; max-width:1000px; margin:0 auto;}
    .success-card {background:#fff; padding:18px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); display:flex; flex-direction:column; justify-content:space-between; position:relative;}
    .success-card p {font-size:0.95rem; color:#555; text-align:justify;}
    .success-card span.name {font-size:0.85rem; color:#20a4f3; font-weight:600; margin-top:10px; display:block; text-align:right;}
    .views {display:flex; align-items:center; gap:4px; font-size:0.8rem; color:#777; margin-top:6px;}
    .views svg {width:16px; height:16px; opacity:0.4;}
    .reaction-bar {display:flex; justify-content:space-between; align-items:center; margin-top:10px; padding-top:8px; border-top:1px solid #eee;}
    .reaction {display:inline-flex; align-items:center; gap:3px; cursor:pointer; font-size:1.3rem; color:#888; transition:transform 0.2s ease, color 0.2s ease; user-select:none;}
    .reaction.active {color:#ff1744; animation:bounce 0.3s ease;}
    .reaction .count {font-size:0.85rem; color:#333; font-weight:500;}
    @keyframes bounce {0%{transform:scale(1);}30%{transform:scale(1.3);}60%{transform:scale(0.9);}100%{transform:scale(1);}}
    .share-modal {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); backdrop-filter:blur(8px); display:none; justify-content:center; align-items:center; z-index:999;}
    .share-box {background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045); padding:20px; border-radius:18px; color:#fff; text-align:center; width:280px; animation:pop 0.3s ease;}
    @keyframes pop {0%{transform:scale(0.8);opacity:0;}100%{transform:scale(1);opacity:1);}}
    .share-icons {display:flex; justify-content:space-around; margin-top:12px;}
    .share-icons img {width:42px; height:42px; background:#fff; border-radius:50%; padding:5px; cursor:pointer; transition:transform 0.2s ease;}
    .share-icons img:hover {transform:scale(1.2);}
    .copy-link {background:#fff; color:#333; margin-top:12px; padding:6px 10px; border-radius:8px; cursor:pointer; font-size:0.85rem;}
    .share-icon img {width:22px; height:22px;}
  </style>
</head>
<body>

<div class="success-stories">
  <h2>üî• Student Success Stories</h2>
  <div class="success-box">

    <!-- Card 1 -->
    <div class="success-card" data-post-id="1">
      <p>"Main PDSU ki website se judkar apni journey ko ek nayi disha mein le gaya hoon..."</p>
      <span class="name">- Ravi Sharma</span>
      <div class="views">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 11a4 4 0 110-8 4 4 0 010 8z"/></svg>
        <span class="view-count">0</span> views
      </div>
      <div class="reaction-bar">
        <span class="reaction" data-type="like">‚ù§Ô∏è <span class="count">0</span></span>
        <span class="reaction" data-type="thumb">üëç <span class="count">0</span></span>
        <span class="reaction" data-type="dislike">üëé <span class="count">0</span></span>
        <span class="reaction share-icon" onclick="openShare()">
          <img src="https://cdn-icons-png.flaticon.com/512/739/739257.png" alt="Share">
        </span>
      </div>
    </div>

    <!-- Card 2 -->
    <div class="success-card" data-post-id="2">
      <p>"Website ki wajah se mujhe apne exams ke liye best material mila, aur confidence bhi!"</p>
      <span class="name">- Anjali Verma</span>
      <div class="views">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 11a4 4 0 110-8 4 4 0 010 8z"/></svg>
        <span class="view-count">0</span> views
      </div>
      <div class="reaction-bar">
        <span class="reaction" data-type="like">‚ù§Ô∏è <span class="count">0</span></span>
        <span class="reaction" data-type="thumb">üëç <span class="count">0</span></span>
        <span class="reaction" data-type="dislike">üëé <span class="count">0</span></span>
        <span class="reaction share-icon" onclick="openShare()">
          <img src="https://cdn-icons-png.flaticon.com/512/739/739257.png" alt="Share">
        </span>
      </div>
    </div>

    <!-- Card 3 -->
    <div class="success-card" data-post-id="3">
      <p>"Itne easy aur premium design ke sath padhai karna ek alag hi maza hai!"</p>
      <span class="name">- Kunal Singh</span>
      <div class="views">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 11a4 4 0 110-8 4 4 0 010 8z"/></svg>
        <span class="view-count">0</span> views
      </div>
      <div class="reaction-bar">
        <span class="reaction" data-type="like">‚ù§Ô∏è <span class="count">0</span></span>
        <span class="reaction" data-type="thumb">üëç <span class="count">0</span></span>
        <span class="reaction" data-type="dislike">üëé <span class="count">0</span></span>
        <span class="reaction share-icon" onclick="openShare()">
          <img src="https://cdn-icons-png.flaticon.com/512/739/739257.png" alt="Share">
        </span>
      </div>
    </div>

  </div>
</div>

<div class="share-modal" id="shareModal">
  <div class="share-box">
    <h3>Share this Story</h3>
    <div class="share-icons">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" onclick="shareTo('instagram')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" onclick="shareTo('whatsapp')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" onclick="shareTo('telegram')">
    </div>
    <div class="copy-link" onclick="copyLink()"> Copy Link</div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
  import { getDatabase, ref, onValue, set, get, update } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDnydPhUmns376_QXo7CInsSWL7kXO8chU",
    authDomain: "reactionapp-25924.firebaseapp.com",
    databaseURL: "https://reactionapp-25924-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "reactionapp-25924",
    storageBucket: "reactionapp-25924.firebasestorage.app",
    messagingSenderId: "1048361753014",
    appId: "1:1048361753014:web:14015b761a9481ec460917"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const pageURL = "https://gyaankendra.github.io/gyanhai/";

  // üîë Generate unique userId
  let userId = localStorage.getItem("userId");
  if(!userId){
    userId = "U" + Math.random().toString(36).substr(2,9);
    localStorage.setItem("userId", userId);
  }

  document.querySelectorAll('.success-card').forEach(card => {
    let postId = card.dataset.postId;
    let viewRef = ref(db, 'posts/' + postId + '/views');
    let reactRef = ref(db, 'posts/' + postId + '/reactions');
    let userRef = ref(db, 'posts/' + postId + '/users/' + userId);

    // Views Increment
    get(viewRef).then(snapshot=>{
      let current = snapshot.exists() ? snapshot.val() : 0;
      set(viewRef, current + 1);
    });

    onValue(viewRef, snap=>{
      card.querySelector('.view-count').textContent = snap.exists()? snap.val() : 0;
    });

    // Show Reactions
    onValue(reactRef, snap=>{
      let data = snap.val() || {};
      card.querySelectorAll('.reaction').forEach(btn=>{
        let type = btn.dataset.type;
        if(!type) return;
        btn.querySelector('.count').textContent = data[type] || 0;
      });
    });

    // Show user's active reactions
    onValue(userRef, snap=>{
      let userData = snap.val() || [];
      card.querySelectorAll('.reaction').forEach(btn=>{
        let type = btn.dataset.type;
        if(!type) return;
        if(userData.includes(type)){
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    });

    // Reaction Click
    card.querySelectorAll('.reaction').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        if(btn.classList.contains('share-icon')) return;
        let type = btn.dataset.type;

        Promise.all([get(reactRef), get(userRef)]).then(([allSnap, userSnap])=>{
          let allData = allSnap.val() || {like:0, thumb:0, dislike:0};
          let userData = userSnap.val() || [];

          if(userData.includes(type)){
            // remove this reaction
            allData[type] = Math.max((allData[type]||0)-1, 0);
            userData = userData.filter(t=>t!==type);
          } else {
            if(userData.length >= 2){
              // remove oldest
              let old = userData.shift();
              allData[old] = Math.max((allData[old]||0)-1, 0);
            }
            userData.push(type);
            allData[type] = (allData[type]||0)+1;
          }

          set(reactRef, allData);
          set(userRef, userData);
        });
      });
    });
  });

  function openShare(){document.getElementById('shareModal').style.display='flex';}
  window.openShare = openShare;
  document.getElementById('shareModal').addEventListener('click',e=>{
    if(e.target.id==='shareModal') e.target.style.display='none';
  });

  function copyLink(){navigator.clipboard.writeText(pageURL); alert("Link Copied!");}
  window.copyLink = copyLink;

  function shareTo(platform){
    let encoded = encodeURIComponent(pageURL);
    if(platform==='whatsapp'){
      window.location.href = `whatsapp://send?text=${encoded}`;
      setTimeout(()=>{window.open(`https://wa.me/?text=${encoded}`,'_blank');},1500);
    } else if(platform==='instagram'){
      window.location.href = `instagram://share?text=${encoded}`;
      setTimeout(()=>{window.open(`https://www.instagram.com/?url=${encoded}`,'_blank');},1500);
    } else if(platform==='telegram'){
      window.location.href = `tg://msg_url?url=${encoded}`;
      setTimeout(()=>{window.open(`https://t.me/share/url?url=${encoded}`,'_blank');},1500);
    }
  }
  window.shareTo = shareTo;
</script>

</body>
</html>
